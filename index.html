<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Video Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/video.js/dist/video-js.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        #video-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .video-wrapper {
            display: flex;
            flex-direction: column;
            position: relative;
            width: 100%;
            transition: all 0.3s ease;
        }

        .highlighted {
            order: -1;
            flex-basis: 100%;
            margin-bottom: 20px;
        }

        .highlighted [id*="video-"] {
            width: 100%;
            height: 500px;
        }

        .muted {
            width: 300px;
            transition: all 0.3s ease;
        }

        iframe,
        video {
            width: 100%;
            height: auto;
        }

        .video-title {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 14px;
            z-index: 100;
        }

        .start-time-container {
            text-align: center;
            margin-top: 10px;
        }

        #controls {
            margin: 20px 0;
        }

        #seek-bar-container {
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #notes-container {
            margin-top: 20px;
        }

        .note {
            margin: 10px 0;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>

<body>

    <h1>Enhanced Video Manager</h1>

    <div>
        <input type="text" id="youtube-url" placeholder="Enter YouTube URL" style="width: 300px;">
        <input type="text" id="video-title" placeholder="Enter Video Title" style="width: 300px;">
        <button id="add-video">Add Video</button>
    </div>

    <div id="video-list"></div>

    <div id="controls">
        <button id="play-all">Play All</button>
        <button id="pause-all">Pause All</button>
        <button id="mute-main">Mute All Except Main</button>
        <button id="save-data">Save Data</button>
        <button id="load-data">Load Data</button>
        <select id="select-video">
            <option value="" disabled selected>Select a Video</option>
        </select>
    </div>

    <div id="seek-bar-container">
        <label for="seek-bar">Seek Bar:</label>
        <input type="range" id="seek-bar" min="0" max="100" step="0.1" value="0" style="width: 300px;">
        <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
        <button id="toggle-play-pause">Play</button>
    </div>

    <div id="notes-container">
        <h2>Notes</h2>
        <div id="editor-container"></div>
        <button id="save-note">Save Note</button>
        <div id="saved-notes"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/video.js/dist/video.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-youtube/dist/Youtube.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash/lodash.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script>
        const videoList = [];
        const notes = [];
        const savedData = { videos: [], notes: [] };
        let isPlaying = false;

        const videoListContainer = document.getElementById('video-list');
        const youtubeUrlInput = document.getElementById('youtube-url');
        const videoTitleInput = document.getElementById('video-title');
        const seekBar = document.getElementById('seek-bar');
        const currentTimeDisplay = document.getElementById('current-time');
        const totalTimeDisplay = document.getElementById('total-time');
        const togglePlayPauseButton = document.getElementById('toggle-play-pause');
        const selectVideoDropdown = document.getElementById('select-video');

        const quill = new Quill('#editor-container', { theme: 'snow' });

        function updateVideoDropdown() {
            selectVideoDropdown.innerHTML = `<option value="" disabled selected>Select a Video</option>`;
            videoList.forEach((_, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Video ${index + 1}`;
                selectVideoDropdown.appendChild(option);
            });
        }

        document.getElementById('add-video').addEventListener('click', () => {
            const youtubeUrl = youtubeUrlInput.value.trim();
            const videoTitle = videoTitleInput.value.trim() || `Video ${videoList.length + 1}`;
            if (!youtubeUrl) return alert('Please enter a valid YouTube URL');

            const videoId = `video-${Date.now()}`;
            const videoWrapper = document.createElement('div');
            videoWrapper.classList.add('video-wrapper');
            videoWrapper.innerHTML = `
            <video
                id="${videoId}"
                class="video-js"
                controls
                preload="auto"
                data-setup='{
                    "techOrder": ["youtube"],
                    "sources": [{ "src": "${youtubeUrl}", "type": "video/youtube" }]
                }'>
            </video>
            <div class="video-title">${videoTitle}</div>
            <div class="start-time-container">
                <label>Start Time: <input type="number" class="start-time" value="0" style="width: 60px;"> sec</label>
            </div>
        `;
            videoListContainer.appendChild(videoWrapper);

            const player = videojs(videoId);
            player.on('loadedmetadata', () => {
                totalTimeDisplay.textContent = formatTime(Math.floor(player.duration()));
            });

            const videoIndex = videoList.length;
            videoList.push({ player, startTime: 0, title: videoTitle, url: youtubeUrl, wrapper: videoWrapper });

            const startTimeInput = videoWrapper.querySelector('.start-time');
            startTimeInput.addEventListener('input', () => {
                const startTime = parseFloat(startTimeInput.value) || 0;
                videoList[videoIndex].startTime = startTime;
            });

            if (videoIndex > 0) {
                player.muted(true);
                videoWrapper.classList.add('muted');
            } else {
                videoWrapper.classList.add('highlighted');
            }

            updateVideoDropdown();
            youtubeUrlInput.value = '';
            videoTitleInput.value = '';
        });

        document.getElementById('play-all').addEventListener('click', () => {
            videoList.forEach(({ player, startTime }) => {
                const seekTime = seekBar.value / 100 * videoList[0]?.player.duration();
                const adjustedTime = seekTime + startTime;
                player.currentTime(adjustedTime);
                player.play();
            });
        });

        document.getElementById('pause-all').addEventListener('click', () => {
            videoList.forEach(({ player }) => player.pause());
        });

        togglePlayPauseButton.addEventListener('click', () => {
            if (isPlaying) {
                videoList.forEach(({ player }) => player.pause());
                togglePlayPauseButton.textContent = 'Play';
            } else {
                videoList.forEach(({ player, startTime }) => {
                    const seekTime = seekBar.value / 100 * videoList[0]?.player.duration();
                    const adjustedTime = seekTime + startTime;
                    player.currentTime(adjustedTime);
                    player.play();
                });
                togglePlayPauseButton.textContent = 'Pause';
            }
            isPlaying = !isPlaying;
        });

        selectVideoDropdown.addEventListener('change', (event) => {
            const selectedIndex = parseInt(event.target.value, 10);
            videoList.forEach((item, index) => {
                if (index === selectedIndex) {
                    item.player.muted(false);
                    item.wrapper.classList.remove('muted');
                    item.wrapper.classList.add('highlighted');
                } else {
                    item.player.muted(true);
                    item.wrapper.classList.remove('highlighted');
                    item.wrapper.classList.add('muted');
                }
            });
        });

        seekBar.addEventListener('input', () => {
            const relativeSeekTime = (seekBar.value / 100) * videoList[0]?.player.duration();
            videoList.forEach(({ player, startTime }) => {
                const adjustedSeekTime = relativeSeekTime + startTime;
                player.currentTime(adjustedSeekTime);
            });
            currentTimeDisplay.textContent = formatTime(Math.floor(relativeSeekTime));
        });

        setInterval(() => {
            if (videoList.length > 0) {
                const currentTime = videoList[0]?.player.currentTime() || 0;
                const duration = videoList[0]?.player.duration() || 1;
                seekBar.value = (currentTime / duration) * 100;
                currentTimeDisplay.textContent = formatTime(Math.floor(currentTime));
            }
        }, 500);

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
    </script>

</body>

</html>